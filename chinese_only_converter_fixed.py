#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
纯中文转换器 - 格式保持版
去除所有日语假名，只保留汉字和中文，保持HTML原有格式
"""

import os
import re
import shutil
from pathlib import Path

class ChineseOnlyConverterFixed:
    def __init__(self):
        # 中文汉字标准化映射（简体转繁体以支持日语字库）
        self.char_mapping = {
            # 基础汉字标准化
            '学': '学',    # 学习
            '习': '習',    # 学习
            '练': '練',    # 练习
            '时': '時',    # 时间
            '间': '間',    # 时间/空间
            '过': '過',    # 过程
            '进': '進',    # 进步
            '发': '発',    # 发展
            '现': '現',    # 现在
            '实': '実',    # 现实
            '对': '対',    # 对于
            '关': '関',    # 关于
            '亲': '親',    # 亲爱
            '爱': '愛',    # 爱情
            '观': '観',    # 观看
            '听': '聴',    # 听取
            '说': '説',    # 说明
            '话': '話',    # 会话
            '语': '語',    # 语言
            '个': '個',    # 个人
            '种': '種',    # 种类
            '类': '類',    # 种类
            '样': '様',    # 样子
            '击': '撃',    # 点击
            '选': '選',    # 选择
            '择': '択',    # 选择
            '确': '確',    # 确认
            '认': '認',    # 确认
            '设': '設',    # 设置
            '达': '達',    # 达成
            '获': '獲',    # 获得
            '变': '変',    # 变化
            '传': '伝',    # 传统
            '统': '統',    # 传统
            '场': '場',    # 场所
            '处': '処',    # 处理
            '开': '開',    # 开始
            '结': '結',    # 结束
            '终': '終',    # 终端
            '产': '産',    # 产生
            '业': '業',    # 事业
            '务': '務',    # 事务
            '组': '組',    # 组织
            '织': '織',    # 组织
            '团': '団',    # 团体
            '队': '隊',    # 队伍
            '员': '員',    # 成员
            '长': '長',    # 成长
            '强': '強',    # 强化
            '级': '級',    # 高级
            '单': '単',    # 单独
            '双': '双',    # 双重
            '轻': '軽',    # 轻重
            '难': '難',    # 困难
            '简': '簡',    # 简单
            '复': '復',    # 复杂
            '杂': '雑',    # 复杂
            '问': '問',    # 问题
            '题': '題',    # 问题
            '应': '応',    # 回应
            '报': '報',    # 报告
            '释': '釈',    # 解释
            '记': '記',    # 记录
            '录': '録',    # 记录
            '忆': '憶',    # 记忆
            '虑': '慮',    # 考虑
            '觉': '覚',    # 感觉
            '见': '見',    # 意见
            '图': '図',    # 图像
            '显': '表',    # 显示
            '给': '給',    # 给予
            '计': '計',    # 计划
            '划': '画',    # 计划
            '额': '額',    # 金额
            '钱': '錢',    # 金钱
            '币': '幣',    # 货币
            '货': '貨',    # 货币
            '价': '価',    # 价格
            '值': '値',    # 价值
            '费': '費',    # 费用
            '买': '買',    # 购买
            '购': '購',    # 购买
            '卖': '売',    # 销售
            '销': '販',    # 销售
            '售': '売',    # 销售
            '东': '東',    # 东西
            '后': '後',    # 前后
            '边': '辺',    # 边缘
            '缘': '縁',    # 边缘
            '线': '線',    # 线条
            '颜': '顔',    # 颜色
            '黑': '黒',    # 黑色
            '绿': '緑',    # 绿色
            '头': '頭',    # 头部
            '焰': '炎',    # 火焰
            '冰': '氷',    # 冰
            '风': '風',    # 风
            '云': '雲',    # 云
            '晚': '晩',    # 晚期
            '响': '響',    # 响声
            '闻': '聞',    # 听闻
            '动': '動',    # 推动
            '压': '圧',    # 按压
            '载': '載',    # 下载
            '删': '削',    # 删除
            '增': '増',    # 增加
            '减': '減',    # 减少
            '宽': '広',    # 宽窄
            '窄': '狭',    # 宽窄
            '远': '遠',    # 远近
            '慢': '遅',    # 快慢
            '缓': '緩',    # 缓慢
            '紧': '緊',    # 紧张
            '张': '張',    # 紧张
            '连': '連',    # 连接
            '离': '離',    # 分离
            '坏': '壊',    # 破坏
            '补': '補',    # 修补
            '伤': '傷',    # 受伤
            '药': '薬',    # 药物
            '疗': '療',    # 治疗
            '护': '護',    # 护理
            '养': '養',    # 营养
            '营': '栄',    # 营养
            '饭': '飯',    # 吃饭
            '饮': '飲',    # 饮食
            '鱼': '魚',    # 鱼类
            '蛋': '卵',    # 鸡蛋
            '鸡': '鶏',    # 鸡蛋
            '面': '麺',    # 面条
            '盐': '塩',    # 盐类
            '醋': '酢',    # 醋类
            '酱': '醤',    # 酱类
            '辣': '辛',    # 辣椒
            '甜': '甘',    # 甜味
            '咸': '塩',    # 咸味
            '丑': '醜',    # 丑陋
            '恶': '悪',    # 善恶
            '负': '負',    # 正负
            '积': '積',    # 积极
            '极': '極',    # 积极
            '乐': '楽',    # 快乐
            '怕': '怖',    # 害怕
            '绪': '緒',    # 情绪
            '气': '気',    # 生气
            '谢': '謝',    # 感谢
            '闹': '騒',    # 吵闹
            '吵': '騒',    # 吵闹
            '哭': '泣',    # 哭泣
            '叹': '嘆',    # 叹息
            '舞': '踊',    # 跳舞
            '蹈': '踊',    # 舞蹈
            '剧': '劇',    # 戏剧
            '电': '電',    # 电影
            '视': '視',    # 电视
            '摄': '撮',    # 拍摄
            '镜': '鏡',    # 镜头
            '环': '環',    # 环境
            '帘': '簾',    # 窗帘
            '窗': '窓',    # 窗帘
            '锁': '錠',    # 门锁
            '钥': '鍵',    # 钥匙
            '墙': '壁',    # 墙壁
            '顶': '頂',    # 屋顶
            '厅': '間',    # 客厅
            '脚': '足',    # 脚步
            '步': '歩',    # 脚步
            '腿': '脚',    # 腿脚
            '盖': '蓋',    # 膝盖
            '肚': '腹',    # 肚子
            '胳': '腕',    # 胳膊
            '脸': '顔',    # 脸部
            '眼': '目',    # 眼睛
            '嘴': '口',    # 嘴巴
            '牙': '歯',    # 牙齿
            '齿': '歯',    # 牙齿
            '舌': '舌',    # 舌头
            '喉': '喉',    # 喉咙
            '须': '髭',    # 胡须
            '胡': '髭',    # 胡须
            '肤': '膚',    # 皮肤
            '肌': '筋',    # 肌肉
            '灵': '霊',    # 灵魂
            '识': '識',    # 意识
            '忆': '憶',    # 记忆
            '梦': '夢',    # 梦想
            '睡': '眠',    # 睡觉
            '鞋': '靴',    # 鞋子
            '袜': '靴',    # 袜子
            '柜': '棚',    # 柜子
            '脑': '脳',    # 电脑
            '笔': '筆',    # 笔记
            '纸': '紙',    # 纸张
            '档': '資',    # 档案
            '资': '資',    # 资料
            '邮': '郵',    # 邮件
            '证': '証',    # 证件
            '于': '於',    # 于
        }
        
        # 日语词汇替换为中文词汇
        self.word_replacements = {
            'プラン': '方案',
            'カード': '卡片',
            'ヘアスタイル': '发型',
            'おすすめ': '推荐',
            'これ': '此',
            'それ': '其',
            'この': '此',
            'その': '其',
            'ズボン': '裤子',
            'スカート': '裙子',
            'シャツ': '衬衫',
            'ベルト': '腰带',
            'バッグ': '包',
            'ソファ': '沙发',
            'エアコン': '空调',
            'ブラシ': '刷子',
            'ペースト': '膏体',
            'クリーム': '霜膏',
            'パウダー': '粉末',
            'ゴム': '橡胶',
            'ハサミ': '剪刀',
            'ホッチキス': '订书机',
            'ファイル': '文件',
            'ニック': '昵',
            'ネーム': '称',
            'コーヒー': '咖啡',
            'ピンク': '粉色',
            'オレンジ': '橙色',
        }
    
    def clean_text_content(self, text):
        """
        清理文本内容，保持格式不变
        """
        result = text
        
        # 先替换日语词汇为中文
        for japanese_word, chinese_word in self.word_replacements.items():
            result = result.replace(japanese_word, chinese_word)
        
        # 标准化汉字
        for chinese_char, japanese_char in self.char_mapping.items():
            if japanese_char:
                result = result.replace(chinese_char, japanese_char)
        
        # 去除日语假名，但保持空白字符和换行
        result = re.sub(r'[ぁ-ゖ]', '', result)  # 去除平假名
        result = re.sub(r'[ァ-ヾ]', '', result)  # 去除片假名
        
        return result
    
    def process_html_file(self, file_path):
        """
        处理单个HTML文件，保持原有格式
        """
        try:
            # 读取文件
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()
            
            # 只清理文本内容，保持HTML格式
            converted_content = self.clean_text_content(content)
            
            # 写回文件
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(converted_content)
            
            print(f"✓ 已处理: {file_path}")
            return True
            
        except Exception as e:
            print(f"✗ 处理失败 {file_path}: {str(e)}")
            return False
    
    def process_directory(self, directory_path):
        """
        处理目录中的所有HTML文件
        """
        directory = Path(directory_path)
        if not directory.exists():
            print(f"错误: 目录不存在 - {directory_path}")
            return
        
        # 创建备份目录
        backup_dir = directory.parent / f"{directory.name}_backup_fixed"
        if not backup_dir.exists():
            print(f"创建备份目录: {backup_dir}")
            shutil.copytree(directory, backup_dir)
            print("✓ 备份完成")
        
        # 查找所有HTML文件
        html_files = list(directory.glob("*.html"))
        if not html_files:
            print("未找到HTML文件")
            return
        
        print(f"找到 {len(html_files)} 个HTML文件")
        
        # 处理每个文件
        success_count = 0
        for html_file in html_files:
            if self.process_html_file(html_file):
                success_count += 1
        
        print(f"\n处理完成: {success_count}/{len(html_files)} 个文件成功处理")

def main():
    """
    主函数
    """
    converter = ChineseOnlyConverterFixed()
    
    # 设置目录路径
    directory_path = "translated_help_pages"
    
    print("纯中文转换器 - 格式保持版")
    print("=" * 50)
    print(f"目标目录: {directory_path}")
    print("注意: 去除日语假名，保持HTML格式")
    print("=" * 50)
    
    # 询问用户确认
    confirm = input("确定要开始转换吗? (y/n): ").lower().strip()
    if confirm not in ['y', 'yes', '是']:
        print("操作已取消")
        return
    
    # 开始处理
    converter.process_directory(directory_path)
    print("\n转换完成!")

if __name__ == "__main__":
    main() 